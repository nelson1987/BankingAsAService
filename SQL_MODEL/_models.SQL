/*
Created: 09/01/2023
Modified: 09/01/2023
Model: Microsoft SQL Server 2014
Database: MS SQL Server 2014
*/


-- Drop keys for tables section -------------------------------------------------

ALTER TABLE [TB_TRANSACAO] DROP CONSTRAINT [PK_TB_TRANSACAO]
go
ALTER TABLE [TB_CONTA_CLIENTE] DROP CONSTRAINT [PK_TB_CONTA_CLIENTE]
go
ALTER TABLE [TB_CLIENTE] DROP CONSTRAINT [PK_TB_CLIENTE]
go
ALTER TABLE [TB_CONTA] DROP CONSTRAINT [PK_TB_CONTA]
go
ALTER TABLE [TB_EMPRESA] DROP CONSTRAINT [PK_TB_EMPRESA]
go




-- Drop tables section ---------------------------------------------------

DROP TABLE [TB_TRANSACAO]
go
DROP TABLE [TB_CONTA_CLIENTE]
go
DROP TABLE [TB_CLIENTE]
go
DROP TABLE [TB_CONTA]
go
DROP TABLE [TB_EMPRESA]
go

-- Create tables section -------------------------------------------------

-- Table TB_EMPRESA

CREATE TABLE [TB_EMPRESA]
(
 [IDT_EMPRESA] Int IDENTITY(1,1) NOT NULL,
 [NOM_EMPRESA] Varchar(100) NOT NULL,
 [NUM_DOCUMENTO] Varchar(14) NOT NULL
)
go

-- Add keys for table TB_EMPRESA

ALTER TABLE [TB_EMPRESA] ADD CONSTRAINT [PK_TB_EMPRESA] PRIMARY KEY ([IDT_EMPRESA])
go

-- Table TB_CONTA

CREATE TABLE [TB_CONTA]
(
 [IDT_CONTA] Int IDENTITY(1,1) NOT NULL,
 [NUM_CONTA] Varchar(21) NOT NULL,
 [TPO_CONTA] Char(1) DEFAULT 1 NOT NULL,
 [IDT_CLIENTE] Int NOT NULL,
 [DTA_CRIACAO] Datetime NOT NULL,
 [STA_CONTA] Int NOT NULL
)
go

-- Add keys for table TB_CONTA

ALTER TABLE [TB_CONTA] ADD CONSTRAINT [PK_TB_CONTA] PRIMARY KEY ([IDT_CONTA])
go

-- Table TB_CLIENTE

CREATE TABLE [TB_CLIENTE]
(
 [IDT_CLIENTE] Int IDENTITY(1,1) NOT NULL,
 [NOM_CLIENTE] Varchar(100) NOT NULL,
 [NUM_DOCUMENTO] Varchar(14) NOT NULL,
 [TPO_CLIENTE] Char(1) NOT NULL
)
go

-- Add keys for table TB_CLIENTE

ALTER TABLE [TB_CLIENTE] ADD CONSTRAINT [PK_TB_CLIENTE] PRIMARY KEY ([IDT_CLIENTE])
go

-- Table TB_CONTA_CLIENTE

CREATE TABLE [TB_CONTA_CLIENTE]
(
 [IDT_CONTA] Int NOT NULL,
 [IDT_CLIENTE] Int NOT NULL,
 [IDT_EMPRESA] Int NOT NULL,
 [FLG_TITULAR] Bit DEFAULT 1 NOT NULL
)
go

-- Add keys for table TB_CONTA_CLIENTE

ALTER TABLE [TB_CONTA_CLIENTE] ADD CONSTRAINT [PK_TB_CONTA_CLIENTE] PRIMARY KEY ([IDT_CONTA],[IDT_CLIENTE],[IDT_EMPRESA])
go

-- Table TB_TRANSACAO

CREATE TABLE [TB_TRANSACAO]
(
 [IDT_TRANSACTION] Int IDENTITY(1,1) NOT NULL,
 [IDT_CONTA] Int NOT NULL,
 [DTA_TRANSACAO] Datetime DEFAULT GETDATE() NOT NULL,
 [VLR_TRANSACAO] Numeric(18,2) NOT NULL,
 [DTA_AGENDAMENTO] Datetime DEFAULT GETDATE() NULL,
 [BANCO_CONTRAPARTE] Varchar(3) NOT NULL,
 [AGENCIA_CONTRAPARTE] Varchar(4) NOT NULL,
 [CONTA_CONTRAPARTE] Varchar(21) NOT NULL,
 [DOCUMENTO_CONTRAPARTE] Varchar(14) NOT NULL
)
go

-- Add keys for table TB_TRANSACAO

ALTER TABLE [TB_TRANSACAO] ADD CONSTRAINT [PK_TB_TRANSACAO] PRIMARY KEY ([IDT_TRANSACTION],[IDT_CONTA])
go

-- Create foreign keys (relationships) section ------------------------------------------------- 


ALTER TABLE [TB_CONTA_CLIENTE] ADD CONSTRAINT [PK_TB_CONTA_X_TB_CONTA_TB_CLIENTE] FOREIGN KEY ([IDT_CONTA]) REFERENCES [TB_CONTA] ([IDT_CONTA]) ON UPDATE NO ACTION ON DELETE NO ACTION
go



ALTER TABLE [TB_CONTA_CLIENTE] ADD CONSTRAINT [PK_TB_CLIENTE_X_TB_CONTA_TB_CLIENTE] FOREIGN KEY ([IDT_CLIENTE]) REFERENCES [TB_CLIENTE] ([IDT_CLIENTE]) ON UPDATE NO ACTION ON DELETE NO ACTION
go



ALTER TABLE [TB_CONTA_CLIENTE] ADD CONSTRAINT [Relationship3] FOREIGN KEY ([IDT_EMPRESA]) REFERENCES [TB_EMPRESA] ([IDT_EMPRESA]) ON UPDATE NO ACTION ON DELETE NO ACTION
go



ALTER TABLE [TB_TRANSACAO] ADD CONSTRAINT [Relationship4] FOREIGN KEY ([IDT_CONTA]) REFERENCES [TB_CONTA] ([IDT_CONTA]) ON UPDATE NO ACTION ON DELETE NO ACTION
go




